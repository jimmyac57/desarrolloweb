<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Jimmy Aguilera" />
    <title>Agregar Donación</title>
    <link
      rel="stylesheet"
      type="text/css"
      th:href="@{/css/agregar-donacion.css}"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300..700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <section>
    
      <div th:if="${exito}">
        <div id="conf-box">
          <h2 id="conf-msg">Muchas gracias por su donación</h2>
          <a class="button" th:href="@{/}">Volver al inicio</a>
        </div>
      </div>

      <div id="conf-box" style="display: none">
        <h2 id="conf-msg">
          ¡Formulario Válido! ¿Confirma que desea publicar esta donación?
        </h2>
        <button class="button-submit" id="button-submit" type="submit">
          Si, Confirmo
        </button>
        <button class="button-back" type="button" id="button-back">
          No, quiero volver
        </button>
      </div>

      <form
        id="myForm"
        th:action="@{/validar}"
        method="post"
        enctype="multipart/form-data"
        th:if="${not exito}"
        th:object="${donacionFormDTO}"
      >
        <h1>Formulario de donación</h1>
        <!-- Información de contacto -->
        <fieldset>
          <legend>Información de contacto</legend>
          <label for="nombre"><em>Nombre:</em></label>
          <input
            type="text"
            id="nombre"
            th:field="*{nombre}"
            minlength="3"
            maxlength="80"
          />
          <span
            class="error"
            th:if="${#fields.hasErrors('nombre')}"
            th:errors="*{nombre}"
          ></span>
          <br />

          <label for="email"><em>Email:</em></label>
          <input type="email" id="email" th:field="*{email}" />
          <span
            class="error"
            th:if="${#fields.hasErrors('email')}"
            th:errors="*{email}"
          ></span>
          <br />

          <label for="celular"><em>Número celular:</em></label>
          <input type="tel" id="celular" th:field="*{celular}" />
          <span
            class="error"
            th:if="${#fields.hasErrors('celular')}"
            th:errors="*{celular}"
          ></span>
          <br />

          <label for="region"><em>Región:</em></label>
          <select id="region" th:field="*{region}">
            <option value="" selected>Seleccione una región</option>
            <option
              th:each="region : ${regiones}"
              th:value="${region.id}"
              th:text="${region.nombre}"
            ></option>
          </select>
          <span
            class="error"
            th:if="${#fields.hasErrors('region')}"
            th:errors="*{region}"
          ></span>
          <br />

          <label for="comuna"><em>Comuna:</em></label>
          <select id="comuna" th:field="*{comuna}">
            <option value="" selected>Seleccione una comuna</option>
            <option
              th:each="comuna : ${comunas}"
              th:value="${comuna.id}"
              th:text="${comuna.nombre}"
            ></option>
          </select>
          <span
            class="error"
            th:if="${#fields.hasErrors('comuna')}"
            th:errors="*{comuna}"
          ></span>
        </fieldset>

        <!-- Lista de dispositivos -->
        <fieldset>
          <legend>Información del/los dispositivo(s)</legend>
          <div id="dispositivos-container">
            <!-- Dispositivos existentes en el DTO -->
            <div
              th:each="dispositivo, iterStat : *{dispositivos}"
              class="dispositivo-item"
            >
              <fieldset>
                <legend>Dispositivo [[${iterStat.index+1}]]</legend>

                <label>Nombre:</label>
                <input
                  type="text"
                  th:field="*{dispositivos[__${iterStat.index}__].nombre}"
                  minlength="3"
                  maxlength="80"
                />
                <span
                  class="error"
                  th:if="${#fields.hasErrors('dispositivos[__${iterStat.index}__].nombre')}"
                  th:errors="*{dispositivos[__${iterStat.index}__].nombre}"
                ></span>
                <br />

                <label>Descripción:</label>
                <textarea
                  th:field="*{dispositivos[__${iterStat.index}__].descripcion}"
                  rows="4"
                ></textarea>
                <span
                  class="error"
                  th:if="${#fields.hasErrors('dispositivos[__${iterStat.index}__].descripcion')}"
                  th:errors="*{dispositivos[__${iterStat.index}__].descripcion}"
                ></span>
                <br />

                <label>Tipo:</label>
                <select th:field="*{dispositivos[__${iterStat.index}__].tipo}">
                  <option value="">Seleccione una opción</option>
                  <option value="1">Pantalla</option>
                  <option value="2">Notebook</option>
                  <option value="3">Tablet</option>
                  <option value="4">Celular</option>
                  <option value="5">Consola</option>
                  <option value="6">Mouse</option>
                  <option value="7">Teclado</option>
                  <option value="8">Impresora</option>
                  <option value="9">Parlante</option>
                  <option value="10">Audífonos</option>
                  <option value="11">Otro</option>
                </select>
                <span
                  class="error"
                  th:if="${#fields.hasErrors('dispositivos[__${iterStat.index}__].tipo')}"
                  th:errors="*{dispositivos[__${iterStat.index}__].tipo}"
                ></span>
                <br />

                <label>Años de uso:</label>
                <input
                  type="number"
                  th:field="*{dispositivos[__${iterStat.index}__].uso}"
                  min="1"
                  max="99"
                />
                <span
                  class="error"
                  th:if="${#fields.hasErrors('dispositivos[__${iterStat.index}__].uso')}"
                  th:errors="*{dispositivos[__${iterStat.index}__].uso}"
                ></span>
                <br />

                <label>Estado:</label>
                <select
                  th:field="*{dispositivos[__${iterStat.index}__].estado}"
                >
                  <option value="">Seleccione una opción</option>
                  <option value="1">Funciona perfecto</option>
                  <option value="2">Funciona a medias</option>
                  <option value="3">No funciona</option>
                </select>
                <span
                  class="error"
                  th:if="${#fields.hasErrors('dispositivos[__${iterStat.index}__].estado')}"
                  th:errors="*{dispositivos[__${iterStat.index}__].estado}"
                ></span>
                <br />

                <label>Archivos:</label>
                <input
                  type="file"
                  th:field="*{dispositivos[__${iterStat.index}__].archivos}"
                  multiple
                />
                <span
                  class="error"
                  th:if="${#fields.hasErrors('dispositivos[__${iterStat.index}__].archivos')}"
                  th:errors="*{dispositivos[__${iterStat.index}__].archivos}"
                ></span>
                <br />
              </fieldset>
            </div>
          </div>

          <button type="button" id="agregar-dispositivo">
            Agregar otro dispositivo
          </button>
        </fieldset>

        <button class="button-publicar" id="button-publicar" type="submit">
          Publicar esta donación
        </button>

        <a class="button" th:href="@{/}">Volver al inicio</a>
      </form>
    </section>

    <!-- Template oculto para clonar nuevos dispositivos -->
    <template id="dispositivo-template">
      <div class="dispositivo-item">
        <fieldset>
          <legend>Dispositivo __title__</legend>

          <label>Nombre:</label>
          <input type="text" name="nombre" minlength="3" maxlength="80" />
          <br />

          <label>Descripción:</label>
          <textarea name="descripcion" rows="4"></textarea>
          <br />

          <label>Tipo:</label>
          <select name="tipo">
            <option value="">Seleccione una opción</option>
            <option value="1">Pantalla</option>
            <option value="2">Notebook</option>
            <option value="3">Tablet</option>
            <option value="4">Celular</option>
            <option value="5">Consola</option>
            <option value="6">Mouse</option>
            <option value="7">Teclado</option>
            <option value="8">Impresora</option>
            <option value="9">Parlante</option>
            <option value="10">Audífonos</option>
            <option value="11">Otro</option>
          </select>
          <br />

          <label>Años de uso:</label>
          <input type="number" name="uso" min="1" max="99" />
          <br />

          <label>Estado:</label>
          <select name="estado">
            <option value="">Seleccione una opción</option>
            <option value="1">Funciona perfecto</option>
            <option value="2">Funciona a medias</option>
            <option value="3">No funciona</option>
          </select>
          <br />

          <label>Archivos:</label>
          <input type="file" name="archivos" multiple />
          <br />
        </fieldset>
      </div>
    </template>

    <script th:if="${!exito}" th:src="@{/js/poblarComunas.js}"></script>
    <script th:if="${!exito}" th:src="@{/js/agregarDispositivo.js}"></script>
  </body>
</html>
